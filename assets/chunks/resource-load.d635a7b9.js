import{u as Se,O as He,P as fe,a as Te,T as Ee}from"../app.c2288951.js";import{d as Fe,f as H,a3 as Ae,h as Pe,w as Ce,k as ke,C as d,a0 as We,V as K}from"./framework.3b97cefe.js";const Ne={data:{type:Object,required:!0,default:()=>({title:[],rows:[]}),validator:e=>Array.isArray(e.title)&&Array.isArray(e.rows)},customColumns:{type:Array,default:()=>[]},rowDataIndexs:{type:Array,required:!0,validator:e=>e.length>0,default:()=>[]},enablePagination:{type:Boolean,default:!0},enableIndexColumn:{type:Boolean,default:!0},indexText:{type:String,default:""},indexColumnWidth:{type:Number,default:66},enableTip:{type:Boolean,default:!0},headerColumnHeight:{type:Number,default:70},headerBgColor:{type:String,default:"#F5F6F7"},headerBorderColor:{type:String,default:"#E8E8E8"},headerFontStyle:{type:String,default:"normal bold 14px PingFang SC"},headerFontColor:{type:String,default:"#000"},bodyBgColor:{type:String,default:"#fff"},bodyBorderColor:{type:String,default:"#E8E8E8"},bodyFontStyle:{type:String,default:"normal 12px PingFang SC"},bodyFontColor:{type:String,default:"#000"},bodyCellHoverBgColor:{type:String,default:"#F5F6F7"},barChartFontColor:{type:String,default:"#333"},lineDottedSize:{type:Number,default:4},lineBorderColor:{type:String,default:"#95D150"},barWidth:{type:Number,default:40},barColumnPaddingLeft:{type:Number,default:4},rowColumnHeight:{type:Number,default:130}},te=(e,F,A,v,P,U,N=4,q="normal bold 14px PingFang SC",G="#000",y="normal 12px PingFang SC",I="#000",g="#F5F6F7",R="#333")=>{const x=document.getElementById(e),t=x==null?void 0:x.getContext("2d"),[X,Y]=[t.canvas.width,t.canvas.height];t.clearRect(0,0,X,Y);const k=(f,l)=>{f.forEach(o=>{if(t.beginPath(),t.fillStyle=o.activeHover?g:o.bgColor,t.fillRect(o.left,o.top,o.width,o.height),o!=null&&o.borderColor&&(t.strokeStyle=o.borderColor,t.strokeRect(o.left-1,o.top-1,o.width+2,o.height+2)),o!=null&&o.text){t.textBaseline="top",t.font=q;let u=t.measureText(o.text).width;if(u>100&&l==="tableBody"){const W=o.text.split("");W.splice(7);const J=W.join("");o.text=J+"...",u=t.measureText(o.text).width}const w=(o.width-u)/2+o.left,D=t.measureText(o.text).actualBoundingBoxAscent+t.measureText(o.text).actualBoundingBoxDescent,Z=(o.height-D)/2+o.top;t.fillStyle=l==="tableBody"?I:G,t.fillText(o.text,w,Z)}})},V=f=>{f.forEach(l=>{if(t.beginPath(),t.fillStyle=l.bgColor,t.fillRect(l.left,l.top,l.width,l.height),l.borderColor&&(t.strokeStyle=l.borderColor,t.strokeRect(l.left-1,l.top-1,l.width+2,l.height+2)),l.text){t.textBaseline="top",t.font=y;const o=t.measureText(l.text).width,u=(l.width-o)/2+l.left,w=t.measureText(l.text).actualBoundingBoxAscent+t.measureText(l.text).actualBoundingBoxDescent,D=(l.height-w)/2+l.top;t.fillStyle=R,t.fillText(l.text,u,D)}})},m=f=>{if(f.length===0)return!1;let l=f[0].left,o=f[0].top;f.forEach((u,w)=>{t.beginPath(),t.arc(u.left,u.top,N,0,2*Math.PI),t.closePath(),t.fillStyle=u.color,t.fill(),w>0&&(t.beginPath(),t.moveTo(l,o),t.lineTo(u.left,u.top),t.strokeStyle=u.color,t.stroke(),l=u.left,o=u.top)})};Array.isArray(F)&&(F==null?void 0:F.length)>0&&k(F,"tableHeader"),Array.isArray(A)&&(A==null?void 0:A.length)>0&&k(A,"tableBody"),Array.isArray(P)&&(P==null?void 0:P.length)>0&&U==="line"&&P.forEach(f=>{Array.isArray(f)&&(f==null?void 0:f.length)>0&&m(f)}),Array.isArray(v)&&(v==null?void 0:v.length)>0&&U==="bar"&&V(v)},[_,T]=[10,10],s=1,[Re,Me]=[180,160],Oe=260;var E=(e=>(e.BAR="bar",e.LINE="line",e))(E||{});const je={"resourceLoad.index":"index","resourceLoad.bar":"Bar Chart","resourceLoad.number":"Number","resourceLoad.line":"Line Chart","resourceLoad.only":"ordinal","resourceLoad.item":"records","resourceLoad.general":"total","resourceLoad.noData":"No data, please pass in relevant data"},Ie={"resourceLoad.index":"序号","resourceLoad.bar":"柱状图","resourceLoad.number":"数值","resourceLoad.line":"折线图","resourceLoad.only":"第","resourceLoad.item":"条","resourceLoad.general":"共","resourceLoad.noData":"暂无数据"},$e="/assets/table-null.00d83ca0.png";function be(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!We(e)}const qe=Fe({name:"HBResourceLoad",props:Ne,emits:["clickChartCell","changePage"],setup(e,{emit:F,slots:A}){const{t:v,mergeLocaleMessage:P,locale:U}=Se();P("en-US",je),P("zh-CN",Ie);const N="canvas_"+new Date().getTime(),q=H(0),G=H(0),y=H(E.BAR),I=H(!1);let g=[],R=[],x=[];const t=H(1),X=H(10),Y=H(0);let k={},V=[],m=[];const f=H(""),l=H({}),o=Ae({left:"0px",top:"0px",display:"none"});let u=0;const w=Pe(()=>{const n=[];return[...new Set(e.rowDataIndexs.map(a=>a.groupIndex))].forEach(a=>{const h={groupIndex:a,dataIndexArray:[],groupWidth:e.barWidth};e.rowDataIndexs.forEach(c=>{c.groupIndex===a&&h.dataIndexArray.push(c)}),n.push(h)}),n}),D=()=>{y.value!==E.BAR&&(I.value=!1),W()},Z=()=>{g=[],e.enableIndexColumn&&g.push({id:"index_"+new Date().getTime(),left:_,top:T,width:e.indexColumnWidth,height:e.headerColumnHeight,bgColor:e.headerBgColor,borderColor:e.headerBorderColor,text:e.indexText?e.indexText:v("resourceLoad.index")}),e.customColumns.forEach(n=>{let r=_;g.forEach(a=>{r+=a.width+s*2}),g.push({id:n.id,left:r,top:T,width:n.width,height:e.headerColumnHeight,bgColor:e.headerBgColor,borderColor:e.headerBorderColor,text:n.text})}),R=JSON.parse(JSON.stringify(g))},W=()=>{var h,c,i,b,L,ae,le,ne,re,de,ue,ie,ce,he;if(Z(),x=[],u=0,k={},w.value.forEach(C=>{k[C.groupIndex]=[]}),m=[],!((h=e.data)!=null&&h.title)||((i=(c=e.data)==null?void 0:c.title)==null?void 0:i.length)===0)return;let n=0,r=_;g.forEach(C=>{r+=C.width+s*2}),u=s*2+e.barColumnPaddingLeft,w.value.forEach(C=>{u+=C.groupWidth+e.barColumnPaddingLeft});const a=Math.round((e.headerColumnHeight-s*2)/2);if((b=e.data)==null||b.title.forEach((C,M)=>{var $;g.push({left:M===0?r:r+u*n,top:T,width:u*(C==null?void 0:C.days.length),height:a,bgColor:e.headerBgColor,borderColor:e.headerBorderColor,text:C.range}),(($=C.days)==null?void 0:$.length)>0&&C.days.forEach(O=>{g.push({left:r+u*n,top:a+T+s*2,width:u,height:a,bgColor:e.headerBgColor,borderColor:e.headerBorderColor,text:O.dayOfWeek}),n+=1})}),e.enablePagination&&(t.value=((L=e.data)==null?void 0:L.page)!==void 0?(ae=e.data)==null?void 0:ae.page:0,X.value=((le=e.data)==null?void 0:le.pageSize)!==void 0?(ne=e.data)==null?void 0:ne.pageSize:0,Y.value=((re=e.data)==null?void 0:re.total)!==void 0?(de=e.data)==null?void 0:de.total:0),((ie=(ue=e.data)==null?void 0:ue.rows)==null?void 0:ie.length)>0){let C=0;(he=(ce=e.data)==null?void 0:ce.rows)==null||he.forEach((M,$)=>{C=T+(e.rowColumnHeight+s*2)*$+(e.headerColumnHeight+s*2),e.enableIndexColumn&&x.push({left:_,top:C,width:e.indexColumnWidth,height:e.rowColumnHeight,bgColor:e.bodyBgColor,borderColor:e.bodyBorderColor,text:(t.value-1)*X.value+$+1}),e.customColumns.forEach(B=>{let z=_;for(let S=0;S<R.length&&R[S].id!==B.id;S++)z+=R[S].width+s*2;x.push({left:z,top:C,width:B.width,height:e.rowColumnHeight,bgColor:e.bodyBgColor,borderColor:e.bodyBorderColor,text:M[B.dataIndex]})});const O={};y.value===E.LINE&&w.value.forEach(B=>{O[B.groupIndex]=[]}),M==null||M.load.forEach((B,z)=>{x.push({left:r+u*z,top:C,width:u,height:e.rowColumnHeight,bgColor:e.bodyBgColor,borderColor:e.bodyBorderColor,text:"",content:B,id:M.id}),w.value.forEach((S,Le)=>{const Q=B[S.groupIndex];let se=0;S.dataIndexArray.forEach(j=>{if(!j.renderTypes.includes(y.value))return;se+=Q[j.dataIndex];const ge=T+e.headerColumnHeight+s*2+(e.rowColumnHeight+s*2)*($+1)-se/24*e.rowColumnHeight;if(Q[j.dataIndex]>=0)if(y.value===E.BAR){const ee=Math.round(Q[j.dataIndex]/24*e.rowColumnHeight);k[S.groupIndex].push({left:r+e.barColumnPaddingLeft+Le*(e.barWidth+s*4)+u*z,top:Math.round(ge),width:e.barWidth,height:ee>e.rowColumnHeight?e.rowColumnHeight:ee,bgColor:j.bgColor,text:ee>16&&I.value?Q[j.dataIndex]:""})}else O[S.groupIndex].push({left:r+e.barColumnPaddingLeft+(e.barWidth+s*4)+u*z,top:Math.round(ge),color:j.bgColor})})})}),y.value===E.LINE&&Object.keys(O).forEach(B=>{O[B].length>0&&m.push(O[B])})}),J(!0),K(()=>{p()})}else J(!1),K(()=>{te(N,g,[],[],[],y.value)})},J=n=>{var h,c;const r=g[g.length-1].left,a=g[g.length-1].width;if(n){if(r+a>0){const b=e.enableTip?Re-Math.round(u/2)+5:5;q.value=r+a+b}const i=e.enableTip?Me-Math.round(e.rowColumnHeight/2):5;G.value=((c=(h=e.data)==null?void 0:h.rows)==null?void 0:c.length)*(e.rowColumnHeight+s*2)+T+e.headerColumnHeight+s*2+i}else r+a>0&&(q.value=r+a+5),G.value=T+e.headerColumnHeight+s*2+Oe},p=()=>{y.value===E.BAR?(V=[],Object.keys(k).forEach(n=>{V.push(...k[n])}),te(N,g,x,V,[],y.value,e.lineDottedSize,e.headerFontStyle,e.headerFontColor,e.bodyFontStyle,e.bodyFontColor,e.bodyCellHoverBgColor,e.barChartFontColor)):te(N,g,x,[],m,y.value,e.lineDottedSize,e.headerFontStyle,e.headerFontColor,e.bodyFontStyle,e.bodyFontColor,e.bodyCellHoverBgColor,e.barChartFontColor)},oe=n=>{const r=document.getElementById(N),a=n.pageX-r.getBoundingClientRect().left,h=n.pageY-r.getBoundingClientRect().top;let c=_-s*2;R.forEach(b=>{c+=b.width+s*2});const i=T+e.headerColumnHeight+s*2;if(a>c&&h>i){for(let b=0;b<x.length;b++){const L=x[b];if(L.left<a&&L.left+L.width>a&&L.top<h&&L.top+L.height>h)return{passFlag:!0,item:L}}return{passFlag:!1,item:{}}}else return{passFlag:!1,item:{}}},ve=n=>{const{passFlag:r,item:a}=oe(n);if(r){x.forEach(c=>{c.activeHover=void 0}),a.activeHover||(a.activeHover=!0,K(()=>{p()}));let h=0;w.value.forEach(c=>{Object.keys(a.content[c.groupIndex]).forEach(i=>{a.content[c.groupIndex][i]>0&&(h+=a.content[c.groupIndex][i])})}),o.display=h===0?"none":"block",o.left=a.left+Math.round(u/2)+"px",o.top=a.top+Math.round(e.rowColumnHeight/2)+"px",f.value=a.content.date,l.value=a.content}},ye=()=>{o.display="none",x.forEach(n=>{n.activeHover=void 0}),K(()=>{p()})},xe=()=>{o.display="block"},we=n=>{const{passFlag:r,item:a}=oe(n);r&&F("clickChartCell",a)},Be=(n,r)=>{F("changePage",{page:n,pageSize:r})};return Ce(()=>U.value,()=>{W()}),Ce(()=>e.data,()=>{W()},{deep:!0}),ke(()=>{W()}),()=>{var a,h,c;let n,r;return d("div",{class:"resource-load"},[d("div",{class:"resource-load-query"},[d("div",{class:"resource-load-query-left"},[A.customQuery&&A.customQuery()]),d("div",{class:"resource-load-query-right"},[d(He,{name:"radioGroup",value:y.value,"onUpdate:value":i=>y.value=i,onChange:D},{default:()=>[d(fe,{value:E.BAR},{default:()=>[d("span",{class:"column-text"},[v("resourceLoad.bar")]),d(Te,{checked:I.value,"onUpdate:checked":i=>I.value=i,disabled:y.value!==E.BAR,onChange:W},be(n=v("resourceLoad.number"))?n:{default:()=>[n]})]}),d(fe,{value:"line"},be(r=v("resourceLoad.line"))?r:{default:()=>[r]})]})])]),d("div",{class:"canvas-container"},[d("canvas",{id:N,class:"canvas-load",width:q.value,height:G.value,onClick:we,onMousemove:ve,onMouseleave:ye},null),e.enableTip&&d("div",{class:"tool-tip",style:o,onMouseover:xe},[d("div",{class:"tool-date"},[f.value]),o.display==="block"&&d("div",{class:"tool-content"},[(a=e==null?void 0:e.rowDataIndexs)==null?void 0:a.map(i=>d("div",{class:"tool-item"},[d("div",{class:"item-left"},[d("div",{class:"dot",style:{backgroundColor:i.bgColor}},null),d("span",{title:i.text.length>6?i.text:""},[i.text])]),d("span",{class:"item-right"},[l.value[i.groupIndex]?l.value[i.groupIndex][i.dataIndex]:""])]))])]),((c=(h=e.data)==null?void 0:h.title)==null?void 0:c.length)===0||Array.isArray(e.data)?d("div",{class:"canvas-tip-container"},[d("img",{src:$e},null),d("h3",null,[v("resourceLoad.noData")])]):""]),e.enablePagination&&d("div",{class:"pageination-container"},[d(Ee,{current:t.value,"onUpdate:current":i=>t.value=i,total:Y.value,hideOnSinglePage:!0,showSizeChanger:!1,"show-less-items":!0,"show-quick-jumper":!0,"show-total":(i,b)=>`${v("resourceLoad.only")} ${b[0]}~${b[1]} ${v("resourceLoad.item")} / ${v("resourceLoad.general")} ${i} ${v("resourceLoad.item")}`,onChange:Be},null)]),w.value.length>0&&d("div",{class:"legend-container"},[w.value.map(i=>d("div",{class:"legend-row"},[i.dataIndexArray.map(b=>d("div",{class:"legend-row-item"},[d("div",{class:"legend-row-item-mark",style:{backgroundColor:b.bgColor}},null),d("span",{class:"legend-row-item-text"},[b.text])]))]))])])}}});export{qe as H};
